<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SialConnect - Factories</title>
  
  <!-- Keep your existing CSS -->
  <link rel="stylesheet" href="factories.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
  
  <!-- Add Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
  
  <!-- Add some inline CSS for loading state -->
  <style>
    .loading-spinner {
      text-align: center;
      padding: 50px;
      color: #666;
    }
    .loading-spinner i {
      font-size: 48px;
      animation: spin 1s linear infinite;
    }
    @keyframes spin {
      from { transform: rotate(0deg); }
      to { transform: rotate(360deg); }
    }
    .no-data {
      text-align: center;
      padding: 50px;
      color: #999;
      font-size: 18px;
    }
    .factory-card {
      cursor: pointer;
      transition: transform 0.2s;
    }
    .factory-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 5px 15px rgba(0,0,0,0.2);
    }
  </style>
</head>
<body>
  <!-- Top Info Bar -->
  <div class="top-bar">
    <div class="left">
      <a href="mailto:sialconnect@gmail.com"><i class="fas fa-envelope"></i> sialconnect@gmail.com</a>
      <a href="https://maps.google.com/?q=Sialkot,Punjab,Pakistan" target="_blank"><i class="fas fa-map-marker-alt"></i> Sialkot, Punjab Pakistan</a>
    </div>
    <div class="right">
      <a href="profile.html"><i class="fas fa-user-circle"></i></a>
    </div>
  </div>

  <!-- Navigation Bar -->
  <nav class="navbar">
    <div class="logo"> 
      <img src="logo.jpg" alt="SialConnect Logo"> 
      SIALCONNECT 
    </div>
    <ul class="nav-links">
      <li><a href="sialconnt.html">HOME</a></li>
      <li><a href="factories.html">FACTORY</a></li>
      <li><a href="categories.html">CATEGORY</a></li>
      <li><a href="aboutme.html">ABOUT US</a></li>
    </ul>
    <div class="search-box">
      <i class="fas fa-search"></i>
      <input type="text" id="searchInput" placeholder="Search factories...">
    </div>
  </nav>

  <div class="hero">
    <h1>WELCOME to <br> Industrial state of Sialkot</h1>
  </div>

  <!-- Dynamic Factory List -->
  <main class="factory-list" id="factoryList">
    <!-- Loading state -->
    <div class="loading-spinner" id="loadingState">
      <i class="fas fa-spinner"></i>
      <p>Loading factories...</p>
    </div>
  </main>

  <script>
    // Firebase Configuration
    const firebaseConfig = {
      apiKey: "AIzaSyCEA_n66W-Dt6eBoPe7QiaSUebEv8ctBaE",
      authDomain: "sialconnect-5efb5.firebaseapp.com",
      projectId: "sialconnect-5efb5",
      storageBucket: "sialconnect-5efb5.appspot.com",
      messagingSenderId: "660615885537",
      appId: "1:660615885537:web:27e04abd3396adfcde3da0"
    };

    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    // Function to load factories from Firebase
    async function loadFactories() {
      const factoryList = document.getElementById('factoryList');
      
      try {
        console.log('Fetching factories from Firebase...');
        const snapshot = await db.collection('factories').get();
        
        console.log(`Found ${snapshot.size} factories`);
        
        // Clear loading state
        factoryList.innerHTML = '';
        
        if (snapshot.empty) {
          factoryList.innerHTML = `
            <div class="no-data">
              <i class="fas fa-industry" style="font-size: 48px; color: #ddd;"></i>
              <p>No factories found</p>
              <p style="font-size: 14px; color: #aaa;">Add factories from the admin panel</p>
            </div>
          `;
          return;
        }
        
        // Add each factory
        snapshot.forEach(doc => {
          const factory = doc.data();
          const factoryCard = createFactoryCard(factory, doc.id);
          factoryList.appendChild(factoryCard);
        });
        
      } catch (error) {
        console.error('Error loading factories:', error);
        factoryList.innerHTML = `
          <div class="no-data">
            <i class="fas fa-exclamation-triangle" style="font-size: 48px; color: #f44336;"></i>
            <p>Error loading factories</p>
            <p style="font-size: 14px; color: #aaa;">${error.message}</p>
            <button onclick="loadFactories()" style="margin-top: 10px; padding: 10px 20px; background: #2196F3; color: white; border: none; border-radius: 5px; cursor: pointer;">
              Retry
            </button>
          </div>
        `;
      }
    }

    // Function to create factory card element
    function createFactoryCard(factory, id) {
      const card = document.createElement('div');
      card.className = 'factory-card';
      card.onclick = () => openFactory(id);
      
      // Use placeholder image if no logo
      const logoUrl = factory.logoUrl || 'https://via.placeholder.com/100x100?text=' + (factory.name ? factory.name.charAt(0) : 'F');
      
      // Generate random rating for display (you can store actual ratings in Firebase)
      const rating = (4 + Math.random()).toFixed(1);
      
      card.innerHTML = `
        <img src="${logoUrl}" alt="${factory.name || 'Factory'}" onerror="this.src='https://via.placeholder.com/100x100?text=No+Image'">
        <div class="info">
          <h2>${factory.name || 'Unnamed Factory'}</h2>
          <p>${factory.category || 'No category specified'}</p>
          
          <p style="font-size: 12px; color: #666; margin-top: 5px;">
            <i class="fas fa-map-marker-alt"></i> ${factory.address || 'No address'}
          </p>
        </div>
        <div class="arrow">Â»</div>
      `;
      
      return card;
    }

    // Function to open factory detail page
    function openFactory(factoryId) {
      // Pass the Firebase document ID to the detail page
      window.location.href = `factory1.html?id=${factoryId}`;
    }

    // Search functionality
    document.getElementById('searchInput')?.addEventListener('input', function(e) {
      const searchTerm = e.target.value.toLowerCase();
      const cards = document.querySelectorAll('.factory-card');
      
      cards.forEach(card => {
        const text = card.textContent.toLowerCase();
        card.style.display = text.includes(searchTerm) ? '' : 'none';
      });
    });

    // Load factories when page loads
    window.addEventListener('DOMContentLoaded', () => {
      console.log('Page loaded, fetching factories...');
      loadFactories();
    });

    // Auto-refresh every 30 seconds (optional)
    // setInterval(loadFactories, 30000);
  </script>
</body>
</html>